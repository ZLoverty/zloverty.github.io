<!doctype html>
<html>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=44985&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <title> How to construct pandas DataFrame efficiently </title>
	<link rel="stylesheet" href="/css/main.css">
  
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        tags: 'ams'
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  
  </head>
  <body>

    <nav class="navbar">
  
    <a href="/zh" id="nbelement" >
      中文</a>
  
    <a href="/posts" id="nbelement" >
      Blog</a>
  
    <a href="/code" id="nbelement" >
      Code</a>
  
    <a href="/research" id="nbelement" >
      Research</a>
  
    <a href="/cv" id="nbelement" >
      CV</a>
  
    <div id="spaceholder"></div>
    <a href='/index.html' id="home-icon">
      <img src="/images/icons/icon.svg" height="100%">
    </a>
</nav>

  <div id="main">
    <div id="main-column-mid">
      
  <h1> How to construct pandas DataFrame efficiently </h1>
  <div id="post-date">0001-01-01</div>
  <p>Today, I was reviewing my <a href="https://github.com/ZLoverty/DE/blob/main/Code/HoughCircles-DE.ipynb">droplet tracking code</a> and saw an interesting way to construct <code>pandas.DataFrame</code>:</p>
<ol>
<li>Construct a list of DataFrame, each representing a row: <code>row_list = [pd.DataFrame({&quot;a&quot;: i, &quot;b&quot;: 2*i} for i in range(100))]</code></li>
<li>Concatenate the list into a bigger DataFrame: <code>df = pd.concat(row_list)</code></li>
</ol>
<p>This is not what I normally do, and that&rsquo;s probably why I find it interesting. Normally, I would</p>
<ol>
<li>populate two lists for <code>a</code> and <code>b</code>: <code>a_list = [i for i in range(100)]; b_list = [2*i for i in range(100)]</code></li>
<li>use the lists to initiate DataFrame: <code>df = pd.DataFrame({&quot;a&quot;: a_list, &quot;b&quot;: b_list})</code></li>
</ol>
<p>Intuitively, the second way is faster, because it involves less DataFrame construction. But I do like the first way, in that I do not have to initiate many temporary lists. So I Google it and find <a href="https://stackoverflow.com/questions/17091769/python-pandas-fill-a-dataframe-row-by-row">this question</a>, which gives another intuitive way to do this:</p>
<ol>
<li>initiate a DataFrame with the right dimensions, but full of NaN: <code>df = pd.DataFrame(columns=[&quot;a&quot;, &quot;b&quot;], index=range(100))</code></li>
<li>set values to each row progressively: <code>df.loc[i] = {&quot;a&quot;: i, &quot;b&quot;: 2*i}</code></li>
</ol>
<p>I don&rsquo;t find an answer which is the faster way, or preferred way, to construct the same DataFrame. So I do a small test here.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># dftest.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ind <span style="color:#f92672">=</span> range(<span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># method 1</span>
</span></span><span style="display:flex;"><span>tic <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>row_list <span style="color:#f92672">=</span> [pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#34;a&#34;</span>: i, <span style="color:#e6db74">&#34;b&#34;</span>: <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i} <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ind)]
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(row_list)
</span></span><span style="display:flex;"><span>toc <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;method 1: </span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74"> s&#34;</span><span style="color:#f92672">.</span>format(toc <span style="color:#f92672">-</span> tic))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># method 2</span>
</span></span><span style="display:flex;"><span>tic <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>a_list <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ind]
</span></span><span style="display:flex;"><span>b_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ind]
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#34;a&#34;</span>: a_list, <span style="color:#e6db74">&#34;b&#34;</span>: b_list})
</span></span><span style="display:flex;"><span>toc <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;method 2: </span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74"> s&#34;</span><span style="color:#f92672">.</span>format(toc <span style="color:#f92672">-</span> tic))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># method 3</span>
</span></span><span style="display:flex;"><span>tic <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>], index<span style="color:#f92672">=</span>ind)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ind:
</span></span><span style="display:flex;"><span>    df<span style="color:#f92672">.</span>loc[i] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;a&#34;</span>: i, <span style="color:#e6db74">&#34;b&#34;</span>: <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i}
</span></span><span style="display:flex;"><span>toc <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>monotonic()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;method 3: </span><span style="color:#e6db74">{:.4f}</span><span style="color:#e6db74"> s&#34;</span><span style="color:#f92672">.</span>format(toc <span style="color:#f92672">-</span> tic))
</span></span></code></pre></div><p>Then run it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ python dftest.py
</span></span><span style="display:flex;"><span>method 1: 0.0150 s
</span></span><span style="display:flex;"><span>method 2: 0.0000 s
</span></span><span style="display:flex;"><span>method 3: 1.7810 s
</span></span></code></pre></div><p>Method 2 is the fastest way to construct a DataFrame. Method 1 is also OK for small data, but the fact that it is slower than method 2 suggests that constructing many DataFrame objects takes extra time. Method 3, although being intuitive, is the slowest way. The method is useful for replacing a few spurious data, but not ideal for constructing big DataFrames from scratch.</p>


    </div>
  </div>

    <div class='footer'>	
	<div id="footer-item">
		Last edited: Jun 29, 2025
	</div>
	<div id="spaceholder"></div>
	<div id="footer-item">liuzy19911112@gmail.com</div>
</div>

  </body>
</html>